{% extends "base.html" %}

{% block content %}
{# ---------- Reusable macro(s) ---------- #}
{% macro input_field(type, name, label, placeholder='', required=true, autocomplete='') -%}
  <div class="form-group ds-form-group">
    <label for="{{ name }}" class="ds-label">{{ label }}</label>
    <input
      id="{{ name }}"
      type="{{ type }}"
      name="{{ name }}"
      class="form-control ds-input"
      placeholder="{{ placeholder }}"
      {% if autocomplete %}autocomplete="{{ autocomplete }}"{% endif %}
      {% if required %}required{% endif %}
    />
  </div>
{%- endmacro %}

<section class="dungeon-system white" aria-labelledby="ds-title">
  <header class="ds-header">
    <h2 id="ds-title">LitRPG Books Ranked Tier Tool — Audible Version</h2>
    <p class="ds-subtitle">Authentication Protocol • DCC Style</p>
  </header>

  <article class="ds-body">
    <h3 class="ds-section">Instructions</h3>

    <p><strong>SYSTEM WARNING:</strong><br>
      Crawler, to plunder your Audible Library, you must first submit to authentication.
      Present your Audible credentials or be left gnawing on the bones of empty search results.
    </p>

    <p><strong>2FA REQUIREMENT:</strong><br>
      Unfortunately, this current version of the Audible Library system demands the use of the
      <em>Authenticator App</em>. Yes… even here, in the depths of the dungeon, bureaucracy thrives.
    </p>

    <p><strong>DATA RETENTION NOTICE:</strong><br>
      This system possesses no storage, no memory, no mercy. Once your data is generated, it is cast
      into the dungeon’s oubliette — gone forever, irretrievable, and likely gnawed on by things with too many teeth.
    </p>

    <p><strong>REWARD:</strong><br>
      For completing this perilous task, you will receive… <em>pause for dramatic effect</em>… access to the tool
      capable of forging your <strong>Book Rank List</strong> — an artifact so potent, it will reveal the standing of your tomes
      in ways most crawlers can barely comprehend.
      <br>As an <strong>extra reward</strong>, you shall gain bragging rights in the <strong>Reddit LitRPG</strong> community, forever earning you the
      envious glares (and probably downvotes) of lesser adventurers.
    </p>

    <h4 class="ds-section">Authenticate</h4>
    <form method="POST" class="ds-form" id="audibleAuthForm" novalidate>
      {# If you use CSRF protection, include your token here #}
      {# <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"> #}

      {{ input_field('email', 'username', 'Email', 'you@example.com', true, 'username') }}
      <div class="ds-password-wrap">
        {{ input_field('password', 'password', 'Password', '••••••••', true, 'current-password') }}
        <button class="ds-toggle" type="button" aria-label="Show password" data-toggle="password" data-target="#password">Show</button>
      </div>

      <div class="ds-2fa-hint" role="note">
        <span class="ds-kicker">Heads-up:</span> You’ll be prompted by your Authenticator App during login.
      </div>

      <button type="submit" class="btn btn-primary ds-button" id="loginBtn">
        Login
      </button>
      <p class="ds-footnote">Now fill up the form, and let’s move on with this before the torches burn out.</p>
    </form>
  </article>
</section>

{# ---------- Minimal styles (scoped/optional) ---------- #}
<style>
  .dungeon-system { max-width: 900px; margin: 2rem auto; padding: 1.5rem; border: 2px solid #333; border-radius: 10px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
  .ds-header { border-bottom: 1px dashed #444; margin-bottom: 1rem; padding-bottom: .5rem; }
  .ds-header h2 { margin: 0; letter-spacing: .02em; }
  .ds-subtitle { color: #666; margin: .25rem 0 0; }
  .ds-body p { line-height: 1.6; }
  .ds-section { margin-top: 1rem; margin-bottom: .5rem; }
  .ds-form { margin-top: .5rem; }
  .ds-form-group { margin-bottom: 1rem; }
  .ds-label { font-weight: 600; margin-bottom: .25rem; display: inline-block; }
  .ds-input { padding: .6rem .75rem; }
  .ds-password-wrap { position: relative; }
  .ds-password-wrap .ds-toggle {
    position: absolute; right: .5rem; top: 2.15rem;
    border: 1px solid #888; background: #f7f7f7; padding: .25rem .5rem; border-radius: .35rem; cursor: pointer; font-size: .85rem;
  }
  .ds-toggle:focus { outline: 2px solid #333; outline-offset: 2px; }
  .ds-2fa-hint { margin: .25rem 0 1rem; font-size: .925rem; color: #444; }
  .ds-kicker { font-weight: 700; text-transform: uppercase; margin-right: .25rem; }
  .ds-button { margin-top: .5rem; }
  .ds-footnote { margin-top: .75rem; color: #555; }
</style>

{# ---------- Progressive enhancement (optional) ---------- #}
<script>
  (function () {
    // Toggle password visibility
    document.querySelector('[data-toggle="password"]')?.addEventListener('click', function () {
      const targetSel = this.getAttribute('data-target');
      const input = document.querySelector(targetSel);
      if (!input) return;

      const showing = input.type === 'text';
      input.type = showing ? 'password' : 'text';
      this.textContent = showing ? 'Show' : 'Hide';
      this.setAttribute('aria-label', showing ? 'Show password' : 'Hide password');
    });

    // On submit: disable button + text swap
    const form = document.getElementById('audibleAuthForm');
    const btn  = document.getElementById('loginBtn');
    form?.addEventListener('submit', function () {
      if (btn) {
        btn.disabled = true;
        btn.textContent = 'Authenticating…';
      }
    });
  })();
</script>
{% endblock %}
